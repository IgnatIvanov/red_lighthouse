{% load static %}
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'out_doc/css/edit.css' %}">
    <script type="text/javascript">
        
        function declineRename() {
            document.getElementById('RenameForm').reset();
            document.getElementById('toggle1').checked = false;
        }; 
        
        function declineDelete() {
            document.getElementById('toggle2').checked = false;
        };

        function closeIfOpen(accordion_id) {
            // alert(accordion_id);
            current_state = document.getElementById(accordion_id).checked;
            if (current_state) {
                document.getElementById(accordion_id).checked = false;
            }
            else {
                document.getElementById(accordion_id).checked = true;
            };
        };

        function tattooCheck(e) {
            // Функция проверки введённой собаки по клейму на наличие в БД

            tattoo_field_id = 'tattoo_input';
            tattoo = document.getElementById(tattoo_field_id).value;
            tattoo = tattoo.toUpperCase();
            dogs_tattoo = document.getElementById('dogs_tattoo');
            is_exist = false;

            // Поиск введённого клейма в списке клейм из БД
            for (i in dogs_tattoo.options) {                
                
                tattoo_value = dogs_tattoo.options[i].value;
                if (tattoo_value == undefined) continue;
                tattoo_value = tattoo_value.toUpperCase();
                if (tattoo_value == tattoo) {
                    is_exist = true;
                    break;
                };
            };

            if (is_exist) {
                // Действия, если собака есть в базе
                document.getElementById(tattoo_field_id).style.backgroundColor = '#5F7B55';
            } else {
                // Действия, если собаки нет в базе
                document.getElementById(tattoo_field_id).style.backgroundColor = 'white';
                document.getElementById("breed_input").value = "";
                document.getElementById("rkf_input").value = "";
                document.getElementById("region_input").value = "";
                document.getElementById("birth_date_input").value = "";
                document.getElementById("is_male_input").checked = false;
                document.getElementById("is_female_input").checked = false;
                document.getElementById("chip_input").value = "";
                document.getElementById("name_ru_input").value = "";
                document.getElementById("name_en_input").value = "";
                document.getElementById("colour_ru_input").value = "";
                document.getElementById("colour_en_input").value = "";
                document.getElementById("breeder_input").value = "";
                document.getElementById("owner_input").value = "";
                document.getElementById("father_tattoo_input").value = "";
                document.getElementById("mother_tattoo_input").value = "";
            };
        };
    </script>
</head>
<body>


<datalist id="dogs_tattoo">
    {% for el in dogs_tattoo %}
        <option value="{{ el }}"></option>
    {% endfor %}
</datalist>



<h1>ПРОЕКТ «{{ project_name }}»</h1>

<form method="post">
    {% csrf_token %}
    <button 
        formaction="{% url 'out_doc_select_project' %}">
        Вернуться к выбору проекта
    </button>
</form>

<h2>Управление проектом</h2>
<div class="accordion" onclick="closeIfOpen('manage1')">
    <input id="manage1" type="radio" class="accordion-toggle" name="toggle" />
    <label>Переименовать проект</label>
    <section>
    <div>
        Введите новое название проекта
        <form role="form" action="/requestFine" autocomplete="off" method="POST" id="RenameForm">
            {% csrf_token %}
            <label>Новое название:</label>
            <input type="text" name="project_new_name">
            <button
                type="submit"
                class="btn btn-success"
                name="btn"
                value="rename_project"
                form="RenameForm"
                formaction="{% url 'out_doc_rename_project' project_name %}">
                Ввод
            </button>
        </form>
        <button form="no_form" onclick="declineRename()">Отмена</button>
    </div>
    </section>
</div>
<div class="accordion" onclick="closeIfOpen('manage2')">
    <input id="manage2" type="radio" class="accordion-toggle" name="toggle" />
    <label>Удалить проект</label>
    <section>
    <div>
        Проект будет удалён безвозвратно. Удалить?
        <form method="post">
            {% csrf_token %}
            <button 
                formaction="{% url 'out_doc_delete_project' project_name %}">
                Удалить
            </button>
            <button form="no_form" onclick="declineDelete()">Отмена</button>
        </form>
    </div>
    </section>
</div>


<br>
<h2>Записать собаку на событие</h2>
<form method="post" id="form_project_add_dog">
    {% csrf_token %}    

    <datalist id="classes">
        {% for el in classes_names %}
            <option value="{{ el.name }}"></option>
        {% endfor %}
    </datalist>

    <!-- Поля ввода данных собаки -->
    <input type="text" 
        id="tattoo_input" 
        name="tattoo" 
        placeholder="Клеймо" 
        value=""
        oninput="tattooCheck()"> <br>

    <input list="breeds" 
        id="breed_input" 
        type="text" 
        name="breed" 
        placeholder="Порода" 
        value=""> <br>

    <input type="text" 
        id="rkf_input" 
        name="rkf" 
        placeholder="РКФ" 
        value=""> <br>

    <input type="text" 
        id="region_input" 
        name="region" 
        placeholder="Регион" 
        value=""> <br>

    <input type="date" 
        id="birth_date_input" 
        name="birth_date"
        value=""> <br>
    
    <input type="radio" 
        id="is_male_input" 
        name="sex" 
        value="male" checked>
    <label for="male">Кобель</label> <br>

    <input type="radio" 
        id="is_female_input" 
        name="sex" 
        value="female">
    <label for="female">Сука</label> <br>

    <input type="text" 
        id="chip_input" 
        name="chip" 
        placeholder="Чип" 
        value=""> <br>

    <input type="text" 
        id="name_ru_input" 
        name="name_ru" 
        placeholder="Кличка на русском" 
        value=""> <br>

    <input type="text" 
        id="name_en_input" 
        name="name_en" 
        placeholder="Кличка на английском" 
        value=""> <br>

    <input type="text" 
        id="colour_ru_input" 
        name="colour_ru" 
        placeholder="Окрас на русском" 
        value=""> <br>

    <input type="text" 
        id="colour_en_input" 
        name="colour_en" 
        placeholder="Окрас на английском" 
        value=""> <br>

    <input type="text" 
        id="breeder_input" 
        name="breeder" 
        placeholder="Заводчик" 
        value=""> <br>

    <input type="text" 
        id="owner_input" 
        name="owner" 
        placeholder="Владелец" 
        value=""> <br>

    <input type="text" 
        id="father_tattoo_input" 
        name="father_tattoo" 
        placeholder="Отец" 
        value=""> <br>

    <input type="text" 
        id="mother_tattoo_input" 
        name="mother_tattoo" 
        placeholder="Мать" 
        value=""> <br>

    <span>{{ error }}</span>

    <!-- Список событий -->
    <h3>События в проекте</h3>
    <table>
        {% if events_list %}
            <tr>
                <th>Класс</th>
                <th>Организатор</th>
                <th>Тип</th>
                <th>Ранг</th>
                <th>Дата</th>
                <th>Дополнительно</th>
            </tr>
            {% for el in events_list %}
                <tr>
                    <td>
                        <input list="classes"
                        type="text"
                        id="event {{ el.id }} class"
                        name="event {{ el.id }} class"
                        placeholder="Выберите событие">
                    </td>
                    <td>{{ el.org }}</td>
                    <td>{{ el.type }}</td>
                    <td>{{ el.rank }}</td>
                    <td>{{ el.date }}</td>
                    <td>{{ el.comment }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <p>Нет событий в проекте</p>
        {% endif %}
    </table>


    <button class="btn btn-success"
        type="submit"
        name="btn_project_add_dog"
        value="project_add_dog" 
        formaction="{% url 'project_add_dog' %}">
        Добавить
    </button>

</form>

<datalist id="breeds">
    {% for el in breed_ru_names %}
        <option value="{{ el }}"></option>
    {% endfor %}
</datalist>


<br>
<h2>Вывод документов</h2>
<form method="post">
{% csrf_token %}
<!-- <button 
        class="btn btn-success" 
        type="submit" 
        name="btn" 
        value="print_temp_sertif" 
        formaction="{% url 'out_doc_edit_project' project_name %}">
        Временные сертификаты
</button> -->

<div>
    <input type="checkbox" name="temp_sertif_checkbox" id="temp_sertif_checkbox" />
    <label for="temp_sertif_checkbox">Временные сертификаты (тестирование)</label>
</div>

<div>
    <input type="checkbox" name="events_catalogs_checkbox" id="events_catalogs_checkbox" />
    <label for="events_catalogs_checkbox">Каталоги на каждое событие</label>
</div>

<div>
    <input type="checkbox" name="events_reports_checkbox" id="events_reports_checkbox" />
    <label for="events_reports_checkbox">Отчёты на каждое событие</label>
</div>

<button 
        class="btn btn-success" 
        type="submit" 
        name="create_doc_btn" 
        formaction="{% url 'create_project_doc' project_name %}">
        Создать документы
</button>

{% if events_list %} {{ temp_sertif_message }} {% endif %}

</form>



<br>
<h2>Собаки в проекте</h2>

{% for event in events.values %}
<div class="accordion" onclick="closeIfOpen('event{{ event.id }}')">
    <input id="event{{ event.id }}" type="radio" class="accordion-toggle" name="toggle" />
    <label>
        Орг.: {{ event.org }},
        Тип: {{ event.type }},
        Ранг: {{ event.rank }},
        Дата: {{ event.date }},
        Доп.: {{ event.comment }}
    </label>
    <section>
    <div>
        {% if event.participants_data %}

        <table>
            <tr>
                <th>Группа FCI</th>
                <th>Порода</th>
                <th>Судья, ринг</th>
                <th>Пол</th>
                <th>Класс</th>
                <th>№ п/п</th>
                <th>dog_id</th>
                <th>Кличка</th>
            </tr>
            {% for dog in event.participants_data %}
            <tr>
                <th>{{ dog.fci }}</th>
                <td>{{ dog.breed_ru }} \ <br> {{ dog.breed_en }}</td>
                <td>{{ dog.judge }}, {{ dog.ring }}</td>
                <td>{{ dog.sex_ru }} \ <br> {{ dog.sex_en }}</td>
                <td>{{ dog.class_ru }} \ <br> {{ dog.class_en }}</td>
                <td>{{ dog.npp }}</td>
                <td>{{ dog.dog_id }}</td>
                <td>{{ dog.name }}</td>
                <td> <a href="{% url 'out_doc_delete_participant' dog.participant_id %}">УДАЛИТЬ</a> </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
            Никто пока не записался.
        {% endif %}
    </div>
    </section>
</div>
{% endfor %}
    
</body>